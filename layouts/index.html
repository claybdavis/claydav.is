{{ define "main" }}
<article class="page-content">
    <section class="profile-section stack-on-mobile">
        <div class="profile-text">
            <div class="profile-bio">
                {{ .Content }}
            </div>
        </div>
        <figure class="profile-image">
                                {{ partial "image-processor.html" (dict "src" "images/profile/clay-davis.jpg" "alt" "Clay Davis" "type" "profile" "loading" "eager") }}
        </figure>
    </section>
    
    <section class="contact-section">
        <nav class="contact-icons" aria-label="Contact information">
            <a href="mailto:cdavis@u.northwestern.edu" class="contact-link" aria-label="Email">
                {{ readFile "static/icons/email.svg" | safeHTML }}
            </a>
            <a href="https://scholar.google.com/citations?hl=en&user=ZuazMDwAAAAJ" class="contact-link" aria-label="Google Scholar">
                {{ readFile "static/icons/google-scholar.svg" | safeHTML }}
            </a>
            <a href="https://bsky.app/profile/claydav.is" class="contact-link" aria-label="Bluesky">
                {{ readFile "static/icons/bluesky.svg" | safeHTML }}
            </a>
        </nav>
    </section>
    
    {{ if not .Params.hide_home_widgets }}
    <section class="recent-publications-section">
        <h3>Recent Publications</h3>
        <div class="content-list home-publications-grid stack-on-mobile">
            {{ $allPublications := where (where .Site.RegularPages "Section" "publications") ".Params.date" "!=" nil }}
            {{ $sortedPublications := sort $allPublications ".Params.date" "desc" }}
            {{ range first 3 $sortedPublications }}
            <a href="{{ .RelPermalink }}" class="content-item home-publication-card">
                {{ if .Params.cover_image }}
                <div class="content-item-image">
                    {{ partial "image-processor.html" (dict "src" (printf "images/%s" .Params.cover_image) "alt" (printf "Cover image for %s" .Title) "type" "home" "quality" "85" "anchor" "Center" "scale" 2) }}
                </div>
                {{ end }}
                <div class="content-item-content">
                    <h4>{{ .Title }}</h4>
                    <div class="content-meta">
                        <time datetime="{{ .Date.Format "2006-01-02" }}">
                            {{ with .Params.author }}<span class="publication-author">{{ . }}</span> &middot; {{ end }}{{ .Date.Format "2006" }}
                        </time>
                    </div>
                    {{ with .Params.journal }}<p class="publication-journal">{{ . }}</p>{{ end }}
                </div>
            </a>
            {{ end }}
        </div>
    </section>
    
    <section class="reading-social-section">
        <div class="reading-social-grid stack-on-mobile">
            {{ if .Params.goodreads_username }}
            <div class="reading-column widget-loading">
                <h3>Currently Reading</h3>
                {{ partial "goodreads.html" . }}
            </div>
            {{ end }}
            {{ if .Params.bluesky_username }}
            <div class="social-column widget-loading">
                <h3>Latest Post on Bluesky</h3>
                {{ partial "bluesky.html" . }}
            </div>
            {{ end }}
        </div>
    </section>
    {{ end }}
</article>
{{ end }}

{{ define "page-css" }}
    {{ $listCSS := resources.Get "css/list.css" | resources.Minify | resources.Fingerprint }}
    <link rel="stylesheet" href="{{ $listCSS.RelPermalink }}">
    {{ $pageCSS := resources.Get "css/home.css" | resources.Minify | resources.Fingerprint }}
    <link rel="stylesheet" href="{{ $pageCSS.RelPermalink }}">
    {{ $goodreadsCSS := resources.Get "css/goodreads.css" | resources.Minify | resources.Fingerprint }}
    <link rel="stylesheet" href="{{ $goodreadsCSS.RelPermalink }}">
{{ end }}

{{ define "page-js" }}
    {{ if and .Params.goodreads_username (not .Params.hide_home_widgets) }}
    <script>
        window.goodreadsUsername = '{{ .Params.goodreads_username }}';
    </script>
    {{ $goodreadsJS := resources.Get "js/goodreads-widget.js" }}
    {{ if $goodreadsJS }}
        {{ $goodreadsJS = $goodreadsJS | resources.Minify | resources.Fingerprint }}
        <script src="{{ $goodreadsJS.RelPermalink }}" defer></script>
    {{ end }}
    {{ end }}
    
    {{ if and .Params.bluesky_username (not .Params.hide_home_widgets) }}
    {{ $blueskyJS := resources.Get "js/bluesky-widget.js" }}
    {{ if $blueskyJS }}
        {{ $blueskyJS = $blueskyJS | resources.Minify | resources.Fingerprint }}
        <script src="{{ $blueskyJS.RelPermalink }}" defer></script>
    {{ end }}
    {{ end }}
{{ end }} 