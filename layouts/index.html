{{ define "main" }}
<article class="page-content">
    <section class="profile-section stack-on-mobile">
        <div class="profile-text">
            <div class="profile-bio">
                {{ .Content }}
            </div>
        </div>
        <figure class="profile-image">
                                {{ partial "image-processor.html" (dict "src" "images/profile/clay-davis.jpg" "alt" "Clay Davis" "priority" true) }}
        </figure>
    </section>
    
    <section class="contact-section">
        <nav class="contact-icons" aria-label="Contact information">
            <a href="mailto:cdavis@u.northwestern.edu" class="contact-link" aria-label="Email">
                {{ readFile "static/icons/email.svg" | safeHTML }}
            </a>
            <a href="https://scholar.google.com/citations?hl=en&user=ZuazMDwAAAAJ" class="contact-link" aria-label="Google Scholar">
                {{ readFile "static/icons/google-scholar.svg" | safeHTML }}
            </a>
            <a href="https://bsky.app/profile/claydav.is" class="contact-link" aria-label="Bluesky">
                {{ readFile "static/icons/bluesky.svg" | safeHTML }}
            </a>
        </nav>
    </section>
    
    <section class="recent-publications-section">
        <h1>Recent Publications</h1>
        <div class="content-list stack-on-mobile">
        {{ $allPublications := where (where .Site.RegularPages "Section" "research") ".Params.date" "!=" nil }}
        {{ $filteredPublications := slice }}
        {{ range $allPublications }}
          {{ if and (not (in .RelPermalink "/awards/")) (not (in .RelPermalink "/data/")) }}
            {{ $filteredPublications = $filteredPublications | append . }}
          {{ end }}
        {{ end }}
        {{ $sortedPublications := sort $filteredPublications ".Params.date" "desc" }}
            {{ range first 3 $sortedPublications }}
            <a href="{{ .RelPermalink }}" class="content-item"{{ if eq .Params.landscape 1 }} data-landscape="1"{{ end }}>
                {{ if .Params.cover_image }}
                <div class="content-item-image">
                    {{ partial "image-processor.html" (dict "src" (printf "images/%s" .Params.cover_image) "alt" (printf "Cover image for %s" .Title)) }}
                </div>
                {{ end }}
                <div class="content-item-content">
                    <h3>{{ .Title }}</h3>
                    <div class="content-meta">
                        <h4 class="content-subtitle">
                            <time datetime="{{ .Date.Format "2006-01-02" }}">
                                {{ with .Params.author }}<span class="publication-author">{{ . }}</span> &middot; {{ end }}{{ .Date.Format "2006" }}
                            </time>
                        </h4>
                        {{ with .Params.journal }}<h4 class="content-subtitle publication-journal"><cite>{{ . }}</cite></h4>{{ end }}
                    </div>
                </div>
            </a>
            {{ end }}
        </div>
    </section>
    
    {{ if not .Params.hide_home_widgets }}
    <section class="reading-social-section">
        <div class="reading-social-grid stack-on-mobile">
            {{ if .Params.goodreads_username }}
            <div class="reading-column widget-loading">
                <h1>Currently Reading</h1>
                {{ partial "goodreads.html" . }}
            </div>
            {{ end }}
            {{ if .Params.bluesky_username }}
            <div class="social-column widget-loading">
                <h1>Latest Post on Bluesky</h1>
                {{ partial "bluesky.html" . }}
            </div>
            {{ end }}
        </div>
    </section>
    {{ end }}
</article>
{{ end }}

{{ define "page-css" }}
    {{ $listCSS := resources.Get "css/list.css" | resources.Minify | resources.Fingerprint }}
    <link rel="stylesheet" href="{{ $listCSS.RelPermalink }}">
    {{ $pageCSS := resources.Get "css/home.css" | resources.Minify | resources.Fingerprint }}
    <link rel="stylesheet" href="{{ $pageCSS.RelPermalink }}">
    {{ if not .Params.hide_home_widgets }}
    {{ $goodreadsCSS := resources.Get "css/goodreads.css" | resources.Minify | resources.Fingerprint }}
    <link rel="stylesheet" href="{{ $goodreadsCSS.RelPermalink }}">
    {{ end }}
{{ end }}

{{ define "page-js" }}
    {{ if and .Params.goodreads_username (not .Params.hide_home_widgets) }}
    <script>
        window.goodreadsUsername = '{{ .Params.goodreads_username }}';
    </script>
    {{ $goodreadsJS := resources.Get "js/goodreads-widget.js" }}
    {{ if $goodreadsJS }}
        {{ $goodreadsJS = $goodreadsJS | resources.Minify | resources.Fingerprint }}
        <script src="{{ $goodreadsJS.RelPermalink }}" defer></script>
    {{ end }}
    {{ end }}
    
    {{ if and .Params.bluesky_username (not .Params.hide_home_widgets) }}
    {{ $blueskyJS := resources.Get "js/bluesky-widget.js" }}
    {{ if $blueskyJS }}
        {{ $blueskyJS = $blueskyJS | resources.Minify | resources.Fingerprint }}
        <script src="{{ $blueskyJS.RelPermalink }}" defer></script>
    {{ end }}
    {{ end }}
{{ end }} 