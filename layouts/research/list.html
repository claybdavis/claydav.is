{{ define "main" }}
<article class="page-content">
    
    <!-- Mobile-only research summary (appears at top on mobile) -->
    <section class="research-overview research-overview-mobile">
        <header class="page-header">
            <h1>{{ .Description }}</h1>
        </header>
        <div class="research-text">
            {{ .Summary }}
        </div>
    </section>
    
    <div class="content-layout stack-on-mobile">
        <!-- Left column - Research Overview (desktop only) -->
        <section class="research-overview research-overview-desktop">
            <header class="page-header">
                <h1>{{ .Description }}</h1>
            </header>
            <div class="research-text">
                {{ .ContentWithoutSummary }}
            </div>
        </section>
        
        <!-- Right column - Publication Types -->
        <section class="publications-section">
            {{ range .Sections.ByWeight }}
        {{ $sectionId := "" }}
        {{ if eq .Title "Peer-Reviewed Papers" }}
            {{ $sectionId = "peer-reviewed-papers" }}
        {{ else if eq .Title "Essays" }}
            {{ $sectionId = "essays" }}
        {{ else }}
            {{ $sectionId = (.Title | urlize) }}
        {{ end }}
        <section id="{{ $sectionId }}">
            <header class="page-header">
                <h1><a href="{{ .RelPermalink }}" class="link">{{ .Title }}</a></h1>
                {{ with .Params.description }}
                <h2>{{ . | markdownify }}</h2>
                {{ end }}
            </header>
            <div class="content-list">
                {{ $pages := .RegularPages.ByDate.Reverse }}
                {{ range $pages }}
            <a href="{{ .RelPermalink }}" class="content-item"{{ if eq .Params.landscape 1 }} data-landscape="1"{{ end }}>
                {{ if .Params.cover_image }}
                <div class="content-item-image">
                    {{ partial "image-processor.html" (dict "src" (printf "images/%s" .Params.cover_image) "alt" (printf "Cover image for %s" .Title)) }}
                </div>
                {{ end }}
                    <div class="content-item-content">
                        <h3>{{ .Title }}</h3>
                        <div class="content-meta">
                            <h4 class="content-subtitle">
                                {{ if .Params.author }}{{ .Params.author }}{{ else if .Params.organization }}{{ .Params.organization }}{{ end }}{{ if and (or .Params.author .Params.organization) .Params.date }} &middot; {{ end }}{{ with .Params.date }}<time datetime="{{ . }}">{{ if $.Params.journal }}{{ dateFormat "2006" . }}{{ else }}{{ dateFormat "January 2006" . }}{{ end }}</time>{{ end }}
                            </h4>
                            {{ with .Params.journal }}<h4 class="content-subtitle"><cite>{{ . }}</cite></h4>{{ end }}
                        </div>
                    </div>
                </a>
                {{ end }}
            </div>
        </section>
            {{ end }}
        </section>
    </div>

</article>
{{ end }}

{{ define "page-css" }}
    {{ $listCSS := resources.Get "css/list.css" | resources.Minify | resources.Fingerprint }}
    <link rel="stylesheet" href="{{ $listCSS.RelPermalink }}">
    {{ $pageCSS := resources.Get "css/research.css" | resources.Minify | resources.Fingerprint }}
    <link rel="stylesheet" href="{{ $pageCSS.RelPermalink }}">
    {{ $paginationCSS := resources.Get "css/pagination.css" | resources.Minify | resources.Fingerprint }}
    <link rel="stylesheet" href="{{ $paginationCSS.RelPermalink }}">
{{ end }}

{{ define "page-js" }}
    {{ $sectionPaginationJS := resources.Get "js/section-pagination.js" | resources.Minify | resources.Fingerprint }}
    <script src="{{ $sectionPaginationJS.RelPermalink }}"></script>
    <script>
        // Initialize pagination for sections that need it
        {{ range .Sections.ByWeight }}
          {{ $itemCount := len .RegularPages }}
          {{ $pageSize := 5 }}
          {{ if eq .Title "Peer-Reviewed Papers" }}
            {{ $pageSize = 3 }}
          {{ end }}
          {{ $sectionId := (.Title | urlize) }}
          {{ if gt $itemCount $pageSize }}
        initSectionPagination('{{ $sectionId }}', {{ $pageSize }});
          {{ end }}
        {{ end }}
    </script>
{{ end }} 